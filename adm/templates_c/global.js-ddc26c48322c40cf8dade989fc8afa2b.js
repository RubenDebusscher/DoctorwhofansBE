if(typeof(window.console)=='undefined'){window.console={log:function(str){}};}if(typeof(window.__xatajax_included__)!='object'){window.__xatajax_included__={};};(function(){var headtg=document.getElementsByTagName("head")[0];if(!headtg)return;var linktg=document.createElement("link");linktg.type="text/css";linktg.rel="stylesheet";linktg.href="/index.php?-action=css&--id=switch_use-b34edac24bcf15cf2a43ee5a9e419b13";linktg.title="Styles";headtg.appendChild(linktg);})();if(typeof(window.__xatajax_included__['xataface/modules/g2/global.js'])=='undefined'){window.__xatajax_included__['xataface/modules/g2/global.js']=true;if(typeof(window.__xatajax_included__['xatajax.actions.js'])=='undefined'){window.__xatajax_included__['xatajax.actions.js']=true;if(typeof(window.__xatajax_included__['xatajax.form.core.js'])=='undefined'){window.__xatajax_included__['xatajax.form.core.js']=true;(function(){var $=jQuery;XataJax.form={findField:findField,createForm:createForm,submitForm:submitForm};function findField(startNode,fieldName){var field=null;$(startNode).parents('.xf-form-group').each(function(){if(field){return;}
field=$('[data-xf-field="'+fieldName+'"]',this).get(0);});if(!field){var parentGroup=$(startNode).parents('form').get(0);field=$('[data-xf-field="'+fieldName+'"]',parentGroup).get(0);}
return field;}
function createForm(method,params,target,action){if(typeof(action)=='undefined')action=DATAFACE_SITE_HREF;var form=$('<form></form>').attr('action',action).attr('method',method);if(target)form.attr('target',target);$.each(params,function(key,value){form.append($('<input/>').attr('type','hidden').attr('name',key).attr('value',value));});return form;}
function submitForm(method,params,target,action){var form=createForm(method,params,target,action);$('body').append(form);form.submit();}})();}
(function(){var $=jQuery;if(typeof(XataJax.actions)=='undefined'){XataJax.actions={};}
XataJax.actions.doSelectedAction=doSelectedAction;XataJax.actions.handleSelectedAction=handleSelectedAction;XataJax.actions.hasRecordSelectors=hasRecordSelectors;XataJax.actions.getSelectedIds=getSelectedIds;function getSelectedIds(container,asString){if(typeof(asString)=='undefined')asString=false;var ids=[];var checkboxes=$('input.rowSelectorCheckbox',container);checkboxes.each(function(){if($(this).is(':checked')&&$(this).attr('xf-record-id')){ids.push($(this).attr('xf-record-id'));}});if(asString)return ids.join("\n");return ids;}
function doSelectedAction(params,container,confirmCallback,emptyCallback){var ids=[];var checkboxes=$('input.rowSelectorCheckbox',container);checkboxes.each(function(){if($(this).is(':checked')&&$(this).attr('xf-record-id')){ids.push($(this).attr('xf-record-id'));}});if(ids.length==0){if(typeof(emptyCallback)=='function'){emptyCallback(params,container);}else{alert('No records are currently selected.  Please first select the records that you wish to act upon.');}
return;}
if(typeof(confirmCallback)=='function'){if(!confirmCallback(ids)){return;}}
params['--selected-ids']=ids.join("\n");XataJax.form.submitForm('post',params);}
function hasRecordSelectors(container){return($('input.rowSelectorCheckbox',container).size()>0);}
function handleSelectedAction(aTag,selector){var href=$(aTag).attr('href');var confirmMsg=$(aTag).attr('data-xf-confirm-message');var confirmCallback=null;if(confirmMsg){confirmCallback=function(){return confirm(confirmMsg);};}
var useFullSetIfEmpty=$(aTag).attr('data-xf-use-full-set-if-empty');var emptyCallback=null;if(useFullSetIfEmpty){emptyCallback=function(){if(confirm(useFullSetIfEmpty)){window.location.href=href;}};}
var params=XataJax.util.getRequestParams(href);XataJax.actions.doSelectedAction(params,$(selector),confirmCallback,emptyCallback);return false;}})();}
if(typeof(window.__xatajax_included__['xataface/modules/g2/advanced-find.js'])=='undefined'){window.__xatajax_included__['xataface/modules/g2/advanced-find.js']=true;(function(){var $=jQuery;$(document).ajaxError(function(e,xhr,settings,exception){if(!console)return;console.log(e);console.log(xhr);console.log(settings);console.log(exception);});var g2=XataJax.load('xataface.modules.g2');g2.AdvancedFind=AdvancedFind;function AdvancedFind(o){this.table=$('meta#xf-meta-tablename').attr('content');this.el=$('<div>').addClass('xf-advanced-find').css('display','none').get(0);$.extend(this,o);this.loaded=false;this.loading=false;this.installed=false;if(window.location.hash==='#search'){this.show();}}
$.extend(AdvancedFind.prototype,{load:load,ready:ready,show:show,hide:hide,install:install});function load(callback){callback=callback||function(){};var self=this;$(this.el).load(DATAFACE_SITE_HREF+'?-table='+encodeURIComponent(this.table)+'&-action=g2_advanced_find_form',function(){decorateConfigureButton(this);var params=XataJax.util.getRequestParams();var widgets=[];var formEl=this;$('[name]',this).each(function(){if(params[$(this).attr('name')]){$(this).val(params[$(this).attr('name')]);}
var widget=null;if($(this).attr('data-xf-find-widget-type')){widget=$(this).attr('data-xf-find-widget-type');}else if($(this).get(0).tagName.toLowerCase()=='select'){widget='select';}
if(widget){widgets.push('xataface/findwidgets/'+widget+'.js');}});if(widgets.length>0){XataJax.util.loadScript(widgets.join(','),function(){self.loaded=true;callback.call(self);$('[name]',formEl).each(function(){if(params[$(this).attr('name')]){$(this).val(params[$(this).attr('name')]);}
var widget=null;if($(this).attr('data-xf-find-widget-type')){widget=$(this).attr('data-xf-find-widget-type');}else if($(this).get(0).tagName.toLowerCase()=='select'){widget='select';}
if(widget){var w=new xataface.findwidgets[widget]();w.install(this);}});$('button.xf-advanced-find-clear',formEl).click(function(){$('input[name],select[name]',formEl).val('');return false;});$('button.xf-advanced-find-search',formEl).click(function(){$(this).parents('form').find('[name="-action"]').val('list');$(this).parents('form').submit();});$(self).trigger('onready');});}else{self.loaded=true;callback.call(self);$(self).trigger('onready');}});}
function ready(callback){if(this.loaded){callback.call(this);}else{$(this).bind('onready',callback);if(!this.loading){this.load();}}}
function install(){if(this.installed)return;$(this.el).insertAfter('a.xf-show-advanced-find');this.installed=true;}
function show(){this.ready(function(){window.location.hash='#search';if(!this.loaded)throw"Cannot show advanced find until it is ready.";if(!this.installed)this.install();$(this.el).parents('form').find('[name="-action"]').val('list');if(!$(this.el).is(':visible')){$(this.el).slideDown(function(){var x=$(this).offset().left;$(this).width($(window).width()-x-5);});}});}
function hide(){this.ready(function(){window.location.hash='';if(!this.loaded||!this.installed)return;if($(this.el).is(':visible')){$(this.el).slideUp();}});}
function decorateConfigureButton(el){$('li.configure-advanced-find-form-action a',el).click(function(){var iframe=$('<iframe>').attr('width','100%').attr('height',$(window).height()*0.8).on('load',function(){var winWidth=$(window).width()*0.8;var width=Math.min(800,winWidth);$(this).width(width);var showHideController=iframe.contentWindow.xataface.controllers.ShowHideColumnsController;showHideController.saveCallbacks.push(function(data){data.preventDefault=true;dialog.dialog('close');window.location.reload(true);});}).attr('src',$(this).attr('href')+'&--format=iframe').get(0);;var dialog=$("<div></div>").append(iframe).appendTo("body").dialog({autoOpen:false,modal:true,resizable:false,width:"auto",height:"auto",close:function(){$(iframe).attr("src","");},buttons:{'Save':function(){$('button.save',iframe.contentWindow.document.body).click();}},create:function(event,ui){$('body').addClass('stop-scrolling');},beforeClose:function(event,ui){$('body').removeClass('stop-scrolling');}});dialog.dialog("option","title","Show/Hide Columns").dialog("open");return false;});}})();}
if(typeof(window.__xatajax_included__['jquery.floatheader.js'])=='undefined'){window.__xatajax_included__['jquery.floatheader.js']=true;(function($){$.fn.floatHeader=function(config){config=$.extend({fadeOut:200,fadeIn:200,forceClass:false,markerClass:'floating',floatClass:'floatHeader',recalculate:false,IE6Fix_DetectScrollOnBody:true},config);return this.each(function(){var self=$(this);var tableClone=self[0].cloneNode(false);var table=$(tableClone);var cloneId=table.attr("id")+"FloatHeaderClone";table.attr("id",cloneId);table.parent().remove();self.floatBox=$('<div class="'+config.floatClass+'"style="display:none"></div>');self.floatBox.append(table);self.IEWindowWidth=document.documentElement.clientWidth;self.IEWindowHeight=document.documentElement.clientHeight;if(!$.browser.msie){config.IE6Fix_DetectScrollOnBody=false;}else{if($.browser.version>7){config.IE6Fix_DetectScrollOnBody=false;}}
var scrollElement=config.IE6Fix_DetectScrollOnBody?$('body'):$('div.fixedLeftWrapper').add(window);scrollElement.scroll(function(){if(self.floatBoxVisible){if(!showHeader(self,self.floatBox)){var offset=self.offset();self.floatBox.css('position','absolute');self.floatBox.css('top',offset.top);self.floatBox.css('left',offset.left);self.floatBoxVisible=false;if(config.cbFadeOut){config.cbFadeOut(self.floatBox);}else{self.floatBox.stop(true,true);self.floatBox.fadeOut(config.fadeOut);}}}else if(showHeader(self,self.floatBox)){if(table.children().length===0){createFloater(table,self,config);}
self.floatBoxVisible=true;if($.browser.msie&&$.browser.version<7){self.floatBox.css('position','absolute');}else{self.floatBox.css('position','fixed');}
if(config.cbFadeIn){config.cbFadeIn(self.floatBox);}else{self.floatBox.stop(true,true);self.floatBox.fadeIn(config.fadeIn);}}
if(self.floatBoxVisible){if($.browser.msie&&$.browser.version<=7){self.floatBox.css('top',$(window).scrollTop());}else{self.floatBox.css('top',0);}
self.floatBox.css('left',self.offset().left-$(window).scrollLeft());if(config.recalculate){recalculateColumnWidth(table,self,config);}}});if($.browser.msie&&$.browser.version<=7){$(window).resize(function(){if((self.IEWindowWidth!=document.documentElement.clientWidth)||(self.IEWindowHeight!=document.documentElement.clientHeight)){self.IEWindowWidth=document.documentElement.clientWidth;self.IEWindowHeight=document.documentElement.clientHeight;if(table.children().length>0){table.fastempty();createFloater(table,self,config);}}});}else{$(window).resize(function(){if(table.children().length>0){table.fastempty();createFloater(table,self,config);}});};$(self).after(self.floatBox);this.fhRecalculate=function(){recalculateColumnWidth(table,self,config);};this.fhInit=function(){if(table.children().length>0){table.fastempty();createFloater(table,self,config);}};$.fn.fastempty=function(){if(this[0]){while(this[0].hasChildNodes()){this[0].removeChild(this[0].lastChild);}}
return this;};});};function createFloater(target,template,config){target.width(template.width());var items;if(!config.forceClass&&template.children('thead').length>0){items=template.children('thead').eq(0).children();var thead=jQuery("<thead/>");target.append(thead);target=thead;}else{items=template.find('.'+config.markerClass);}
items.each(function(){var row=$(this);var rowClone=row[0].cloneNode(false);var floatRow=$(rowClone);row.children().each(function(){var cell=$(this);var floatCell=cell.clone();floatCell.width(cell.width());floatRow.append(floatCell);});target.append(floatRow);});}
function recalculateColumnWidth(target,template,config){target.width(template.width());var src;var dst;if(!config.forceClass&&template.children('thead').length>0){src=template.children('thead').eq(0).children().eq(0);dst=target.children('thead').eq(0).children().eq(0);}else{src=template.find('.'+config.markerClass).eq(0);dst=target.children().eq(0);}
dst=dst.children().eq(0);src.children().each(function(index,element){dst.width($(element).width());dst=dst.next();});}
function showHeader(element,floater){var elem=$(element);var top=$(window).scrollTop();var y0=elem.offset().top;var height=elem.height()-floater.height();var foot=elem.children('tfoot');if(foot.length>0){height-=foot.height();}
return y0<=top&&top<=y0+height;}})(jQuery);}
(function(){var $=jQuery;var _=xataface.lang.get;$(document).ready(function(){$('#dataface-sections-left-column').each(function(){var txt=$(this).text().replace(/^\W+/,'').replace(/\W+$/);if(!txt&&$('img',this).length==0)$(this).hide();});$('#left_column').each(function(){var txt=$(this).text().replace(/^\W+/,'').replace(/\W+$/);if(!txt&&$('img',this).length==0)$(this).hide();});var resultListTable=$('#result_list').get(0);if(resultListTable){$(resultListTable).floatHeader({recalculate:true});var rowPermissions={};$('input.rowSelectorCheckbox[data-xf-permissions]',resultListTable).each(function(){var perms=$(this).attr('data-xf-permissions').split(',');$.each(perms,function(){rowPermissions[this]=1;});});$('.result-list-actions li.selected-action').each(function(){var perm=$(this).children('a').attr('data-xf-permission');if(perm&&!rowPermissions[perm]){$(this).hide();}});}
$('table.listing > tbody > tr > td span[data-fulltext]').each(function(){var span=this;if($(span).hasClass('short-text')){return;}
$(span).addClass('short-text');var moreDiv=null;var td=$(this).parent();while($(td).prop('tagName').toLowerCase()!='td'){td=$(td).parent();}
td=$(td).get(0);$(td).css({});var moreButton=$('<a>').addClass('listing-show-more-button').attr('href','#').html('...').click(showMore).get(0);var lessButton=$('<a href="#" class="listing-show-less-button">...</a>').click(showLess).get(0);function showMore(){var width=$(td).width();if(moreDiv==null){var divContent=null;var parentA=$(span).parent('a');if(parentA.size()>0){divContent=parentA.clone();$('span',divContent).removeClass('short-text').removeAttr('data-fulltext').text($(span).attr('data-fulltext'));}else{divContent=$(span).clone();divContent.removeClass('short-text').text($(span).attr('data-fulltext'));}
var divWidth=width-$(moreButton).width()-10;moreDiv=$('<div style="white-space:normal;"></div>').css('width',divWidth).append(divContent).addClass('full-text').get(0);$(td).prepend(moreDiv);}
$(td).addClass('expanded');return false;}
function showLess(){$(td).removeClass('expanded');return false;}
$(td).append(moreButton);$(td).append(lessButton);});$('table.listing td.row-actions-cell').each(function(){var reqWidth=0;$('.row-actions a',this).each(function(){reqWidth+=$(this).outerWidth(true);});$(this).width(reqWidth);$(this).css({padding:0,margin:0,'padding-right':'5px','padding-top':'3px'});});$(".xf-dropdown a.trigger").each(function(){var atag=this;$(this).parent().find('ul li.selected > a').each(function(){$(atag).append(': '+$(this).text());$(atag).parent().addClass('selected');});}).append('<span class="arrow"></span>').click(function(){var atag=this;if($(this).hasClass('menu-visible')){$(this).removeClass('menu-visible');$(this).parent().find(">ul").slideUp('slow');$('body').unbind('click.xf-dropdown');}else{$(this).addClass('menu-visible');$(this).parent().find(">ul").each(function(){if($(atag).hasClass('horizontal-trigger')){var pos=$(atag).position();$(this).css('top',0).css('left',20);}
$(this).css('z-index',10000);}).slideDown('fast',function(){$('body, .xf-dropdown a.trigger').bind('click.xf-dropdown',function(){$('body, .xf-dropdown a.trigger').unbind('click.xf-dropdown');if(this===atag){return;}
if($(atag).hasClass('menu-visible')){$(atag).trigger('click');}});}).show();}
return false;}).hover(function(){$(this).addClass("subhover");},function(){$(this).removeClass("subhover");});var hasResultListCheckboxes=XataJax.actions.hasRecordSelectors($('.resultList'));var hasRelatedListCheckboxes=XataJax.actions.hasRecordSelectors($('.relatedList'));$('.selected-action a').each(function(){if(!hasResultListCheckboxes){$(this).parent().hide();}}).click(function(){try{XataJax.actions.handleSelectedAction(this,'.resultList');}catch(e){console.log(e);}
return false;});$('.selected-or-full-set-action a').click(function(){try{var emptyMessage="No rows currently selected.  Would you like to perform this action on the full found set?";var emptyMessageAtt=$(this).parents('.selected-or-full-set-action').attr('data-xf-use-full-set-if-empty')
if(emptyMessageAtt){emptyMessage=emptyMessageAtt;}
$(this).attr('data-xf-use-full-set-if-empty',emptyMessage);XataJax.actions.handleSelectedAction(this,'.resultList');}catch(e){console.log(e);}
return false;});$('.full-set-action a').click(function(){try{var warningMessage="This action will operate on the full found set.  Do you wish to continue?";var warningMessageAtt=$(this).parents('.full-set-action').attr('data-xf-full-set-warning')
if(warningMessageAtt){warningMessage=warningMessageAtt;}
if(confirm(warningMessage)){return true;}}catch(e){console.log(e);}
return false;});$('.related-selected-action a').each(function(){if(!hasRelatedListCheckboxes){$(this).parent().hide();}}).click(function(){XataJax.actions.handleSelectedAction(this,'.relatedList');return false;});$('.xf-button-bar').each(function(){var bar=this;var container=$(bar).parent();var containerOffset=$(container).offset();if(containerOffset==null)containerOffset={left:0,top:0};var parentWidth=$(container).width();var rightBound=containerOffset.left+parentWidth;var windowWidth=$(window).width();var pos=$(this).offset();var left=pos.left;var screenWidth=$(window).width();var outerWidth=$(this).outerWidth();var excess=outerWidth+pos.left-screenWidth;if(excess>0){var oldWidth=$(this).width();$(this).width(oldWidth-excess);var newWidth=oldWidth-excess;}
$(window).scroll(function(){var container=$(bar).parent();var containerOffset=$(container).offset();if(containerOffset==null)containerOffset={left:0,top:0};var leftMost=containerOffset.left;var rightMost=leftMost+$(container).innerWidth();var currMarginLeft=$(bar).css('margin-left');var scrollLeft=$(window).scrollLeft();if(scrollLeft<left){$(bar).css('margin-left',-30);$(bar).width(Math.min(newWidth+scrollLeft,$(container).innerWidth()-10));}else if(scrollLeft<excess+60){$(bar).css('margin-left',scrollLeft-left-30);}});});$('.list-view-menu').each(function(){var self=this;if($('.action-sub-menu',this).children().size()<2){$(self).hide();}});$('form h3.Dataface_collapsible_sidebar').each(function(){var siblings=$(this).parent().parent().find('>div.xf-form-group-wrapper >h3.Dataface_collapsible_sidebar:visible');if(siblings.size()<=1)$(this).hide();});$('.xf-save-new-related-record a').click(function(){$('form input[name="-Save"]').click();return false;});$('.xf-save-new-record a').click(function(){$('form input[name="--session:save"]').click();return false;});$('.result-stats').each(function(){if($(this).hasClass('details-stats'))return;var resultStats=this;var isRelated=$(resultStats).hasClass('related-result-stats');var start=$('span.start',this).text().replace(/^\W+/,'').replace(/\W+$/);var end=$('span.end',this).text().replace(/^\W+/,'').replace(/\W+$/);var found=$('span.found',this).text().replace(/^\W+/,'').replace(/\W+$/);var limit=$('.limit-field input').val();start=parseInt(start)-1;end=parseInt(end);found=parseInt(found);limit=parseInt(limit);$(this).css('cursor','pointer');$(this).click(function(){var div=$('<div>').addClass('xf-change-limit-dialog');var label=$('<p>Show <input class="limitter" type="text" value="'+(limit)+'" size="2"/> per page starting at <input type="text" value="'+start+'" class="starter" size="2"/> </p>');$('input.limitter',label).change(function(){var query=XataJax.util.getRequestParams();var limitParam='-limit';if(isRelated){limitParam='-related:limit';}
query[limitParam]=$(this).val();window.location.href=XataJax.util.url(query);}).css({'font-size':'12px'});$('input.starter',label).change(function(){var query=XataJax.util.getRequestParams();var skipParam='-skip';if(isRelated){skipParam='-related:skip';}
query[skipParam]=$(this).val();window.location.href=XataJax.util.url(query);}).css({'font-size':'12px'});div.append(label);var offset=$(resultStats).offset();$('body').append(div);$(div).css({position:'absolute',top:offset.top+$(resultStats).height(),left:Math.min(offset.left,$(window).width()-275),'background-color':'#bbccff','z-index':1000,'padding':'2px 5px 2px 10px','border-radius':'5px'});$(div).show();$(div).click(function(e){e.preventDefault();e.stopPropagation();});function onBodyClick(){$(div).remove();$('body').unbind('click',onBodyClick);}
setTimeout(function(){$('body').bind('click',onBodyClick);},1000);});});$('.details-stats').each(function(){var resultStats=this;var cursor=$('span.cursor',this).text();var found=$('span.found',this).text();cursor=parseInt(cursor);found=parseInt(found);$(this).click(function(){var div=$('<div>').addClass('xf-change-limit-dialog');var label=$('<p>Show <input class="limitter" type="text" value="'+(cursor)+'" size="2"/> of '+found+' </p>');$('input.limitter',label).change(function(){var query=XataJax.util.getRequestParams();query['-cursor']=parseInt($(this).val())-1;window.location.href=XataJax.util.url(query);}).css({'font-size':'12px'});div.append(label);var offset=$(resultStats).offset();$('body').append(div);$(div).css({position:'absolute !important',top:offset.top+$(resultStats).height(),left:Math.min(offset.left,$(window).width()-150),'background-color':'#bbccff','z-index':1000,'padding':'2px 5px 2px 10px','border-radius':'5px'});$(div).show();$(div).click(function(e){e.preventDefault();e.stopPropagation();});function onBodyClick(){$(div).remove();$('body').unbind('click',onBodyClick);}
setTimeout(function(){$('body').bind('click',onBodyClick);},1000);}).css('cursor','pointer');});(function(){var searchField=$('.xf-search-field').parents('form').submit(function(){$(this).find(':input[value=""]').each(function(){if($(this).val()===''){$(this).attr('disabled',true);}});});})();(function(){if(typeof(sessionStorage)=='undefined'){sessionStorage={};}
function parseString(str){var parts=str.split('&');var out=[];$.each(parts,function(){var kv=this.split('=');out[decodeURIComponent(kv[0])]=decodeURIComponent(kv[1]);});return out;}
var currTable=$('meta#xf-meta-tablename').attr('content');if(currTable){var currSearch=$('meta#xf-meta-search-query').attr('content');var currSearchUrl=window.location.href;var searchSelected=false;if(!currSearch){currSearch=sessionStorage['xf-currSearch-'+currTable+'-params'];currSearchUrl=sessionStorage['xf-currSearch-'+currTable+'-url'];}else{searchSelected=true;sessionStorage['xf-currSearch-'+currTable+'-params']=currSearch;sessionStorage['xf-currSearch-'+currTable+'-url']=currSearchUrl;}
if(currSearch){var item=$('<li>');if(searchSelected)item.addClass('selected');var a=$('<a>').attr('href',currSearchUrl).attr('title',_('themes.g2.VIEW_SEARCH_RESULTS','View Search results')).text(_('themes.g2.SEARCH_RESULTS','Search Results'));item.append(a);$('.tableQuicklinks').append(item);}
var currRecord=$('meta#xf-meta-record-title').attr('content');var currRecordUrl=window.location.href;var recordSelected=false;if(!currRecord){currRecord=sessionStorage['xf-currRecord-'+currTable+'-title'];currRecordUrl=sessionStorage['xf-currRecord-'+currTable+'-url'];}else{recordSelected=true;sessionStorage['xf-currRecord-'+currTable+'-title']=currRecord;sessionStorage['xf-currRecord-'+currTable+'-url']=currRecordUrl;}
var currRecordId=$('meta#xf-meta-record-id').attr('content');if(currRecordId){(function(){$('a.xf-related-record-link[data-xf-related-record-id]').click(function(){var idKey='xf-parent-of-'+$(this).attr('data-xf-related-record-id');var idUrl='xf-parent-of-url-'+$(this).attr('data-xf-related-record-id');var idTitle='xf-parent-of-title-'+$(this).attr('data-xf-related-record-id');sessionStorage[idKey]=currRecordId;sessionStorage[idUrl]=currRecordUrl;sessionStorage[idTitle]=currRecord;return true;});})();}
if(currRecord){var isChildRecord=false;if(currRecordId){(function(){var idKey='xf-parent-of-'+currRecordId;var idUrl='xf-parent-of-url-'+currRecordId;var idTitle='xf-parent-of-title-'+currRecordId;if(sessionStorage[idUrl]){var item=$('<li>');var a=$('<a>').attr('href',sessionStorage[idUrl]).attr('title',sessionStorage[idTitle]).text(sessionStorage[idTitle]);item.append(a);$('.tableQuicklinks').append(item);isChildRecord=true;}})();}
var item=$('<li>');if(recordSelected)item.addClass('selected');var a=$('<a>').attr('href',currRecordUrl).attr('title',currRecord).text(currRecord);if(isChildRecord){$(a).addClass('xf-child-record');}
item.append(a);$('.tableQuicklinks').append(item);}
var g2=XataJax.load('xataface.modules.g2');var advancedFindForm=new g2.AdvancedFind({});function handleShowAdvancedFind(){advancedFindForm.show();$(this).addClass('expanded').removeClass('collapsed');$(this).unbind('click',handleShowAdvancedFind);$(this).bind('click',handleHideAdvancedFind);};function handleHideAdvancedFind(){advancedFindForm.hide();$(this).addClass('collapsed').removeClass('expanded');$(this).unbind('click',handleHideAdvancedFind);$(this).bind('click',handleShowAdvancedFind);}
$('a.xf-show-advanced-find').bind('click',handleShowAdvancedFind);}})();});})();}
if(typeof(window.__xatajax_included__['xataface/modules/switch_user/switch_user.js'])=='undefined'){window.__xatajax_included__['xataface/modules/switch_user/switch_user.js']=true;(function(){function _(key,defaultValue){if(xataface&&xataface.strings&&xataface.strings[key]){return xataface.strings[key];}else{return defaultValue;}}
var initSwitchUser;var $=jQuery;jQuery(document).ready(function($){var userbar=document.createElement('div');$(userbar).attr('id','switch-user-menu');$(userbar).html(_('switch_user.label.logged_in_as','Logged in as <span id="switch-user-username">&nbsp;</span>.')+' <a href="#" id="switch-user-btn" title="'+
_('switch_user.label.switch_user','Switch User')+'"><span>'+
_('switch_user.label.switch_user','Switch User')+'</span></a>');var usernameSpan=$('#switch-user-username',userbar).get(0);var switchUserBtn=$('#switch-user-btn',userbar).get(0);var isOriginalUser=true;function restoreToOriginalUser(){$.post(DATAFACE_SITE_HREF,{'-action':'switch_user','--restore':1},function(response){try{if(typeof(response)=='string'){eval('response='+response+';');}
if(response.code==200){$(usernameSpan).html(response.username);window.location.reload();}else{throw response.msg;}}catch(e){alert(e);}});}
function switchUser(username){$.post(DATAFACE_SITE_HREF,{'-action':'switch_user','--username':username},function(response){try{if(typeof(response)=='string'){eval('response='+response+';');}
if(response.code==200){$(usernameSpan).html(response.username);window.location.reload();}else{throw response.msg;}}catch(e){alert(e);}});}
initSwitchUser=function(username,isOriginal){$(usernameSpan).html(username);$('body').append(userbar);isOriginalUser=isOriginal;if(!isOriginalUser){$(userbar).addClass('non-original-user');}}
$(switchUserBtn).click(function(){if(isOriginalUser){var user=prompt(_('switch_user.message.enter_username','Please enter the name of the user you wish to switch to.'),_('switch_user.label.username','Username'));if(user){switchUser(user);}}else{if(confirm(_('switch_user.message.are_you_sure','Are you sure you want to exit this user account and return to your own account?'))){restoreToOriginalUser();}}
return false;});$.get(DATAFACE_SITE_HREF,{'-action':'switch_user_status'},function(response){try{if(response.username){initSwitchUser(response.username,response.isOriginal);}}catch(e){}});});})();}
if(typeof(window.__xatajax_included__['RecordDialog/RecordDialog.js'])=='undefined'){window.__xatajax_included__['RecordDialog/RecordDialog.js']=true;(function($){if(typeof(window.xataface)=='undefined'){window.xataface={};}
window.xataface.RecordDialog=RecordDialog;var _=xataface.lang.get;function RecordDialog(o){this.el=document.createElement('div');this.recordid=null;this.table=null;this.baseURL=DATAFACE_URL+'/js/RecordDialog';this.formChanged=false;for(var i in o)this[i]=o[i];this.marginH=this.marginH||25;this.marginW=this.marginW||25;};RecordDialog.version=1;RecordDialog.prototype={display:function(){var dialog=this;$(this.el).load(this.baseURL+'/templates/dialog.html',function(){var frame=$(this).find('.xf-RecordDialog-iframe').css({'width':'100%','height':'96%','padding':0,'margin':0,'border':'none'}).attr('src',dialog.getURL());$(frame).hide();frame.load(function(){$(frame).hide();dialog.formChanged=false;var iframe=$(this).contents();try{var parsed=null;eval('parsed = '+iframe.text()+';');if(parsed['response_code']==200){if(dialog.callback){dialog.callback(parsed['record_data']);}
$(dialog.el).dialog('close');if(parsed['response_message']){dialog.showResponseMessage(parsed['response_message']);}
return;}}catch(err){}
var portalMessage=iframe.find('.portalMessage');portalMessage.detach();iframe.find('.xf-button-bar').remove();var dc=iframe.find('.documentContent').first();if(dc.length==0)dc=iframe.find('#main_section');if(dc.length==0)dc=iframe.find('#main_column');dc.remove();dc.prepend(portalMessage);var ibody=iframe.find('body');var hidden=$(':hidden',ibody);iframe.find('body').addClass('RecordDialogBody').empty();$('script',dc).remove();dc.appendTo(ibody);hidden.each(function(){if(this.tagName=='SCRIPT'){return;}
$('script',this).remove();$(this).appendTo(ibody);$(this).hide();});$('#details-controller, .contentViews, .contentActions, .insert-record-label, .edit-record-label',ibody).hide();$(ibody).css('background-color','transparent');$('.documentContent',ibody).css({'border':'none','margin':0,'padding':0,'background-color':'transparent','overflow':'scroll'});$(frame).fadeIn(function(){dc.height($(frame).parent().innerHeight()-25);});$('input, textarea, select',ibody).change(function(){dialog.formChanged=true;});});});$(this.el).appendTo('body');$('body').addClass('stop-scrolling');var buttons=[{text:_('RecordDialog.OK_BUTTON_LABEL','OK'),click:function(){if(dialog.callback){dialog.callback();}
$(this).dialog('close');}}];$(this.el).dialog({beforeClose:function(){$('body').removeClass('stop-scrolling')
if(dialog.formChanged){return confirm('You have unsaved changes.  Clicking "OK" will discard these changes.  Do you wish to proceed?');}},height:dialog.height||$(window).height()-dialog.marginH,width:dialog.width||$(window).width()-dialog.marginW,title:dialog.title||(this.recordid?'Edit '+this.table+' Record':'Create New '+this.table+' Record'),modal:true});},getURL:function(){var action;if(!this.recordid){action='new';}else{action='edit';}
var url=DATAFACE_SITE_HREF+'?-table='+encodeURIComponent(this.table)+(this.recordid?'&-recordid='+encodeURIComponent(this.recordid):'')+'&-action='+encodeURIComponent(action)+'&-response=json';if(typeof(this.params)=='object'){$.each(this.params,function(key,val){url+='&'+encodeURIComponent(key)+'='+encodeURIComponent(val);});}
return url;},showResponseMessage:function(msg){alert(msg);}};RecordDialog.constructor=RecordDialog;$.fn.RecordDialog=function(options){return this.each(function(){$(this).click(function(){var RecordDialog=xataface.RecordDialog;try{if(xataface.RecordDialog.version===window.top.xataface.RecordDialog.version){RecordDialog=window.top.xataface.RecordDialog;}}catch(e){}
var d=new RecordDialog(options);d.display();});});};})(jQuery);}
if(typeof(window.__xatajax_included__['xataface/modules/ajax_upload/ajax_upload.js'])=='undefined'){window.__xatajax_included__['xataface/modules/ajax_upload/ajax_upload.js']=true;if(typeof(window.__xatajax_included__['xataface/modules/ajax_upload/lib/jquery.iframe-transport.js'])=='undefined'){window.__xatajax_included__['xataface/modules/ajax_upload/lib/jquery.iframe-transport.js']=true;(function(factory){'use strict';if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(window.jQuery);}}(function($){'use strict';var counter=0;$.ajaxTransport('iframe',function(options){if(options.async&&(options.type==='POST'||options.type==='GET')){var form,iframe;return{send:function(_,completeCallback){form=$('<form style="display:none;"></form>');iframe=$('<iframe src="javascript:false;" name="iframe-transport-'+
(counter+=1)+'"></iframe>').bind('load',function(){var fileInputClones;iframe.unbind('load').bind('load',function(){var response;try{response=iframe.contents();if(!response.length||!response[0].firstChild){throw new Error();}}catch(e){response=undefined;}
completeCallback(200,'success',{'iframe':response});$('<iframe src="javascript:false;"></iframe>').appendTo(form);form.remove();});form.prop('target',iframe.prop('name')).prop('action',options.url).prop('method',options.type);if(options.formData){$.each(options.formData,function(index,field){$('<input type="hidden"/>').prop('name',field.name).val(field.value).appendTo(form);});}
if(options.fileInput&&options.fileInput.length&&options.type==='POST'){fileInputClones=options.fileInput.clone();options.fileInput.after(function(index){return fileInputClones[index];});if(options.paramName){options.fileInput.each(function(){$(this).prop('name',options.paramName);});}
form.append(options.fileInput).prop('enctype','multipart/form-data').prop('encoding','multipart/form-data');}
form.submit();if(fileInputClones&&fileInputClones.length){options.fileInput.each(function(index,input){var clone=$(fileInputClones[index]);$(input).prop('name',clone.prop('name'));clone.replaceWith(input);});}});form.append(iframe).appendTo(document.body);},abort:function(){if(iframe){iframe.unbind('load').prop('src','javascript'.concat(':false;'));}
if(form){form.remove();}}};}});$.ajaxSetup({converters:{'iframe text':function(iframe){return $(iframe[0].body).text();},'iframe json':function(iframe){return $.parseJSON($(iframe[0].body).text());},'iframe html':function(iframe){return $(iframe[0].body).html();},'iframe script':function(iframe){return $.globalEval($(iframe[0].body).text());}}});}));}
if(typeof(window.__xatajax_included__['xataface/modules/ajax_upload/lib/jquery.fileupload.js'])=='undefined'){window.__xatajax_included__['xataface/modules/ajax_upload/lib/jquery.fileupload.js']=true;(function(factory){'use strict';if(typeof define==='function'&&define.amd){define(['jquery','./vendor/jquery.ui.widget','./jquery.iframe-transport'],factory);}else{factory(window.jQuery);}}(function($){'use strict';$.widget('blueimp.fileupload',{options:{namespace:undefined,dropZone:$(document),fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,formData:function(form){return form.serializeArray();},add:function(e,data){data.submit();},processData:false,contentType:false,cache:false},_refreshOptionsList:['namespace','dropZone','fileInput'],_isXHRUpload:function(options){var undef='undefined';return!options.forceIframeTransport&&typeof XMLHttpRequestUpload!==undef&&typeof File!==undef&&(!options.multipart||typeof FormData!==undef);},_getFormData:function(options){var formData;if(typeof options.formData==='function'){return options.formData(options.form);}else if($.isArray(options.formData)){return options.formData;}else if(options.formData){formData=[];$.each(options.formData,function(name,value){formData.push({name:name,value:value});});return formData;}
return[];},_getTotal:function(files){var total=0;$.each(files,function(index,file){total+=file.size||1;});return total;},_onProgress:function(e,data){if(e.lengthComputable){var total=data.total||this._getTotal(data.files),loaded=parseInt(e.loaded/e.total*(data.chunkSize||total),10)+(data.uploadedBytes||0);this._loaded+=loaded-(data.loaded||data.uploadedBytes||0);data.lengthComputable=true;data.loaded=loaded;data.total=total;this._trigger('progress',e,data);this._trigger('progressall',e,{lengthComputable:true,loaded:this._loaded,total:this._total});}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();if(xhr.upload){$(xhr.upload).bind('progress',function(e){var oe=e.originalEvent;e.lengthComputable=oe.lengthComputable;e.loaded=oe.loaded;e.total=oe.total;that._onProgress(e,options);});options.xhr=function(){return xhr;};}},_initXHRData:function(options){var formData,file=options.files[0];if(!options.multipart||options.blob){options.headers=$.extend(options.headers,{'X-File-Name':file.name,'X-File-Type':file.type,'X-File-Size':file.size});if(!options.blob){options.contentType=file.type;options.data=file;}else if(!options.multipart){options.contentType='application/octet-stream';options.data=options.blob;}}
if(options.multipart&&typeof FormData!=='undefined'){if(options.postMessage){formData=this._getFormData(options);if(options.blob){formData.push({name:options.paramName,value:options.blob});}else{$.each(options.files,function(index,file){formData.push({name:options.paramName,value:file});});}}else{if(options.formData instanceof FormData){formData=options.formData;}else{formData=new FormData();$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value);});}
if(options.blob){formData.append(options.paramName,options.blob);}else{$.each(options.files,function(index,file){if(file instanceof Blob){formData.append(options.paramName,file);}});}}
options.data=formData;}
options.blob=null;},_initIframeSettings:function(options){options.dataType='iframe '+(options.dataType||'');options.formData=this._getFormData(options);},_initDataSettings:function(options){if(this._isXHRUpload(options)){if(!this._chunkedUpload(options,true)){if(!options.data){this._initXHRData(options);}
this._initProgressListener(options);}
if(options.postMessage){options.dataType='postmessage '+(options.dataType||'');}}else{this._initIframeSettings(options,'iframe');}},_initFormSettings:function(options){if(!options.form||!options.form.length){options.form=$(options.fileInput.prop('form'));}
if(!options.paramName){options.paramName=options.fileInput.prop('name')||'files[]';}
if(!options.url){options.url=options.form.prop('action')||location.href;}
options.type=(options.type||options.form.prop('method')||'').toUpperCase();if(options.type!=='POST'&&options.type!=='PUT'){options.type='POST';}},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);this._initFormSettings(options);this._initDataSettings(options);return options;},_enhancePromise:function(promise){promise.success=promise.done;promise.error=promise.fail;promise.complete=promise.always;return promise;},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();context=context||this.options.context||promise;if(resolveOrReject===true){dfd.resolveWith(context,args);}else if(resolveOrReject===false){dfd.rejectWith(context,args);}
promise.abort=dfd.promise;return this._enhancePromise(promise);},_chunkedUpload:function(options,testOnly){var that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes=options.uploadedBytes||0,mcs=options.maxChunkSize||fs,slice=file.webkitSlice||file.mozSlice||file.slice,upload,n,jqXHR,pipe;if(!(this._isXHRUpload(options)&&slice&&(ub||mcs<fs))||options.data){return false;}
if(testOnly){return true;}
if(ub>=fs){file.error='uploadedBytes';return this._getXHRPromise(false,options.context,[null,'error',file.error]);}
n=Math.ceil((fs-ub)/mcs);upload=function(i){if(!i){return that._getXHRPromise(true,options.context);}
return upload(i-=1).pipe(function(){var o=$.extend({},options);o.blob=slice.call(file,ub+i*mcs,ub+(i+1)*mcs);o.chunkSize=o.blob.size;that._initXHRData(o);that._initProgressListener(o);jqXHR=($.ajax(o)||that._getXHRPromise(false,o.context)).done(function(){if(!o.loaded){that._onProgress($.Event('progress',{lengthComputable:true,loaded:o.chunkSize,total:o.chunkSize}),o);}
options.uploadedBytes=o.uploadedBytes+=o.chunkSize;});return jqXHR;});};pipe=upload(n);pipe.abort=function(){return jqXHR.abort();};return this._enhancePromise(pipe);},_beforeSend:function(e,data){if(this._active===0){this._trigger('start');}
this._active+=1;this._loaded+=data.uploadedBytes||0;this._total+=this._getTotal(data.files);},_onDone:function(result,textStatus,jqXHR,options){if(!this._isXHRUpload(options)){this._onProgress($.Event('progress',{lengthComputable:true,loaded:1,total:1}),options);}
options.result=result;options.textStatus=textStatus;options.jqXHR=jqXHR;this._trigger('done',null,options);},_onFail:function(jqXHR,textStatus,errorThrown,options){options.jqXHR=jqXHR;options.textStatus=textStatus;options.errorThrown=errorThrown;this._trigger('fail',null,options);if(options.recalculateProgress){this._loaded-=options.loaded||options.uploadedBytes||0;this._total-=options.total||this._getTotal(options.files);}},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._active-=1;options.textStatus=textStatus;if(jqXHRorError&&jqXHRorError.always){options.jqXHR=jqXHRorError;options.result=jqXHRorResult;}else{options.jqXHR=jqXHRorResult;options.errorThrown=jqXHRorError;}
this._trigger('always',null,options);if(this._active===0){this._trigger('stop');this._loaded=this._total=0;}},_onSend:function(e,data){var that=this,jqXHR,slot,pipe,options=that._getAJAXSettings(data),send=function(resolve,args){that._sending+=1;jqXHR=jqXHR||((resolve!==false&&that._trigger('send',e,options)!==false&&(that._chunkedUpload(options)||$.ajax(options)))||that._getXHRPromise(false,options.context,args)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options);}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options);}).always(function(jqXHRorResult,textStatus,jqXHRorError){that._sending-=1;that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options);if(options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending){var nextSlot=that._slots.shift();while(nextSlot){if(!nextSlot.isRejected()){nextSlot.resolve();break;}
nextSlot=that._slots.shift();}}});return jqXHR;};this._beforeSend(e,options);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){slot=$.Deferred();this._slots.push(slot);pipe=slot.pipe(send);}else{pipe=(this._sequence=this._sequence.pipe(send,send));}
pipe.abort=function(){var args=[undefined,'abort','abort'];if(!jqXHR){if(slot){slot.rejectWith(args);}
return send(false,args);}
return jqXHR.abort();};return this._enhancePromise(pipe);}
return send();},_onAdd:function(e,data){var that=this,result=true,options=$.extend({},this.options,data),limit=options.limitMultiFileUploads,fileSet,i;if(!(options.singleFileUploads||limit)||!this._isXHRUpload(options)){fileSet=[data.files];}else if(!options.singleFileUploads&&limit){fileSet=[];for(i=0;i<data.files.length;i+=limit){fileSet.push(data.files.slice(i,i+limit));}}
data.originalFiles=data.files;$.each(fileSet||data.files,function(index,element){var files=fileSet?element:[element],newData=$.extend({},data,{files:files});newData.submit=function(){newData.jqXHR=this.jqXHR=(that._trigger('submit',e,this)!==false)&&that._onSend(e,this);return this.jqXHR;};return(result=that._trigger('add',e,newData));});return result;},_normalizeFile:function(index,file){if(file.name===undefined&&file.size===undefined){file.name=file.fileName;file.size=file.fileSize;}},_replaceFileInput:function(input){var inputClone=input.clone(true);$('<form></form>').append(inputClone)[0].reset();input.after(inputClone).detach();$.cleanData(input.unbind('remove'));this.options.fileInput=this.options.fileInput.map(function(i,el){if(el===input[0]){return inputClone[0];}
return el;});if(input[0]===this.element[0]){this.element=inputClone;}},_onChange:function(e){var that=e.data.fileupload,data={files:$.each($.makeArray(e.target.files),that._normalizeFile),fileInput:$(e.target),form:$(e.target.form)};if(!data.files.length){data.files=[{name:e.target.value.replace(/^.*\\/,'')}];}
if(that.options.replaceFileInput){that._replaceFileInput(data.fileInput);}
if(that._trigger('change',e,data)===false||that._onAdd(e,data)===false){return false;}},_onPaste:function(e){var that=e.data.fileupload,cbd=e.originalEvent.clipboardData,items=(cbd&&cbd.items)||[],data={files:[]};$.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();if(file){data.files.push(file);}});if(that._trigger('paste',e,data)===false||that._onAdd(e,data)===false){return false;}},_onDrop:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer,data={files:$.each($.makeArray(dataTransfer&&dataTransfer.files),that._normalizeFile)};if(that._trigger('drop',e,data)===false||that._onAdd(e,data)===false){return false;}
e.preventDefault();},_onDragOver:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer;if(that._trigger('dragover',e)===false){return false;}
if(dataTransfer){dataTransfer.dropEffect=dataTransfer.effectAllowed='copy';}
e.preventDefault();},_initEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.bind('dragover.'+ns,{fileupload:this},this._onDragOver).bind('drop.'+ns,{fileupload:this},this._onDrop);this.options.fileInput.bind('change.'+ns,{fileupload:this},this._onChange);},_destroyEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.unbind('dragover.'+ns,this._onDragOver).unbind('drop.'+ns,this._onDrop);this.options.fileInput.unbind('change.'+ns,this._onChange);},_beforeSetOption:function(key,value){this._destroyEventHandlers();},_afterSetOption:function(key,value){var options=this.options;if(!options.fileInput){options.fileInput=$();}
if(!options.dropZone){options.dropZone=$();}
this._initEventHandlers();},_setOption:function(key,value){var refresh=$.inArray(key,this._refreshOptionsList)!==-1;if(refresh){this._beforeSetOption(key,value);}
$.Widget.prototype._setOption.call(this,key,value);if(refresh){this._afterSetOption(key,value);}},_create:function(){var options=this.options;options.namespace=options.namespace||this.widgetName;if(options.fileInput===undefined){options.fileInput=this.element.is('input:file')?this.element:this.element.find('input:file');}else if(!options.fileInput){options.fileInput=$();}
if(!options.dropZone){options.dropZone=$();}
this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=this._loaded=this._total=0;this._initEventHandlers();},destroy:function(){this._destroyEventHandlers();$.Widget.prototype.destroy.call(this);},enable:function(){$.Widget.prototype.enable.call(this);this._initEventHandlers();},disable:function(){this._destroyEventHandlers();$.Widget.prototype.disable.call(this);},add:function(data){if(!data||this.options.disabled){return;}
data.files=$.each($.makeArray(data.files),this._normalizeFile);this._onAdd(null,data);},send:function(data){if(data&&!this.options.disabled){data.files=$.each($.makeArray(data.files),this._normalizeFile);if(data.files.length){return this._onSend(null,data);}}
return this._getXHRPromise(false,data&&data.context);}});}));}
if(typeof(window.__xatajax_included__['xataface/modules/ajax_upload/lib/jquery.lightbox-0.5.min.js'])=='undefined'){window.__xatajax_included__['xataface/modules/ajax_upload/lib/jquery.lightbox-0.5.min.js']=true;(function($){var impath=XATAFACE_MODULES_AJAX_UPLOAD_URL+'/css/xataface/modules/ajax_upload/lib/jquery-lightbox/';$.fn.lightBox=function(settings){settings=jQuery.extend({overlayBgColor:'#000',overlayOpacity:0.8,fixedNavigation:false,imageLoading:impath+'images/lightbox-ico-loading.gif',imageBtnPrev:impath+'images/lightbox-btn-prev.gif',imageBtnNext:impath+'images/lightbox-btn-next.gif',imageBtnClose:impath+'images/lightbox-btn-close.gif',imageBlank:impath+'images/lightbox-blank.gif',containerBorderSize:10,containerResizeSpeed:400,txtImage:'Image',txtOf:'of',keyToClose:'c',keyToPrev:'p',keyToNext:'n',imageArray:[],activeImage:0},settings);var jQueryMatchedObj=this;function _initialize(){_start(this,jQueryMatchedObj);return false;}
function _start(objClicked,jQueryMatchedObj){$('embed, object, select').css({'visibility':'hidden'});_set_interface();settings.imageArray.length=0;settings.activeImage=0;if(jQueryMatchedObj.length==1){settings.imageArray.push(new Array(objClicked.getAttribute('href'),objClicked.getAttribute('title')));}else{for(var i=0;i<jQueryMatchedObj.length;i++){settings.imageArray.push(new Array(jQueryMatchedObj[i].getAttribute('href'),jQueryMatchedObj[i].getAttribute('title')));}}
while(settings.imageArray[settings.activeImage][0]!=objClicked.getAttribute('href')){settings.activeImage++;}
_set_image_to_view();}
function _set_interface(){$('body').append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-box"><div id="lightbox-container-image"><img id="lightbox-image"><div style="" id="lightbox-nav"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div><div id="lightbox-loading"><a href="#" id="lightbox-loading-link"><img src="'+settings.imageLoading+'"></a></div></div></div><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose"><img src="'+settings.imageBtnClose+'"></a></div></div></div></div>');var arrPageSizes=___getPageSize();$('#jquery-overlay').css({backgroundColor:settings.overlayBgColor,opacity:settings.overlayOpacity,width:arrPageSizes[0],height:arrPageSizes[1]}).fadeIn();var arrPageScroll=___getPageScroll();$('#jquery-lightbox').css({top:arrPageScroll[1]+(arrPageSizes[3]/10),left:arrPageScroll[0]}).show();$('#jquery-overlay,#jquery-lightbox').click(function(){_finish();});$('#lightbox-loading-link,#lightbox-secNav-btnClose').click(function(){_finish();return false;});$(window).resize(function(){var arrPageSizes=___getPageSize();$('#jquery-overlay').css({width:arrPageSizes[0],height:arrPageSizes[1]});var arrPageScroll=___getPageScroll();$('#jquery-lightbox').css({top:arrPageScroll[1]+(arrPageSizes[3]/10),left:arrPageScroll[0]});});}
function _set_image_to_view(){$('#lightbox-loading').show();if(settings.fixedNavigation){$('#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber').hide();}else{$('#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber').hide();}
var objImagePreloader=new Image();objImagePreloader.onload=function(){$('#lightbox-image').attr('src',settings.imageArray[settings.activeImage][0]);_resize_container_image_box(objImagePreloader.width,objImagePreloader.height);objImagePreloader.onload=function(){};};objImagePreloader.src=settings.imageArray[settings.activeImage][0];};function _resize_container_image_box(intImageWidth,intImageHeight){var intCurrentWidth=$('#lightbox-container-image-box').width();var intCurrentHeight=$('#lightbox-container-image-box').height();var intWidth=(intImageWidth+(settings.containerBorderSize*2));var intHeight=(intImageHeight+(settings.containerBorderSize*2));var intDiffW=intCurrentWidth-intWidth;var intDiffH=intCurrentHeight-intHeight;$('#lightbox-container-image-box').animate({width:intWidth,height:intHeight},settings.containerResizeSpeed,function(){_show_image();});if((intDiffW==0)&&(intDiffH==0)){if($.browser.msie){___pause(250);}else{___pause(100);}}
$('#lightbox-container-image-data-box').css({width:intImageWidth});$('#lightbox-nav-btnPrev,#lightbox-nav-btnNext').css({height:intImageHeight+(settings.containerBorderSize*2)});};function _show_image(){$('#lightbox-loading').hide();$('#lightbox-image').fadeIn(function(){_show_image_data();_set_navigation();});_preload_neighbor_images();};function _show_image_data(){$('#lightbox-container-image-data-box').slideDown('fast');$('#lightbox-image-details-caption').hide();if(settings.imageArray[settings.activeImage][1]){$('#lightbox-image-details-caption').html(settings.imageArray[settings.activeImage][1]).show();}
if(settings.imageArray.length>1){$('#lightbox-image-details-currentNumber').html(settings.txtImage+' '+(settings.activeImage+1)+' '+settings.txtOf+' '+settings.imageArray.length).show();}}
function _set_navigation(){$('#lightbox-nav').show();$('#lightbox-nav-btnPrev,#lightbox-nav-btnNext').css({'background':'transparent url('+settings.imageBlank+') no-repeat'});if(settings.activeImage!=0){if(settings.fixedNavigation){$('#lightbox-nav-btnPrev').css({'background':'url('+settings.imageBtnPrev+') left 15% no-repeat'}).unbind().bind('click',function(){settings.activeImage=settings.activeImage-1;_set_image_to_view();return false;});}else{$('#lightbox-nav-btnPrev').unbind().hover(function(){$(this).css({'background':'url('+settings.imageBtnPrev+') left 15% no-repeat'});},function(){$(this).css({'background':'transparent url('+settings.imageBlank+') no-repeat'});}).show().bind('click',function(){settings.activeImage=settings.activeImage-1;_set_image_to_view();return false;});}}
if(settings.activeImage!=(settings.imageArray.length-1)){if(settings.fixedNavigation){$('#lightbox-nav-btnNext').css({'background':'url('+settings.imageBtnNext+') right 15% no-repeat'}).unbind().bind('click',function(){settings.activeImage=settings.activeImage+1;_set_image_to_view();return false;});}else{$('#lightbox-nav-btnNext').unbind().hover(function(){$(this).css({'background':'url('+settings.imageBtnNext+') right 15% no-repeat'});},function(){$(this).css({'background':'transparent url('+settings.imageBlank+') no-repeat'});}).show().bind('click',function(){settings.activeImage=settings.activeImage+1;_set_image_to_view();return false;});}}
_enable_keyboard_navigation();}
function _enable_keyboard_navigation(){$(document).keydown(function(objEvent){_keyboard_action(objEvent);});}
function _disable_keyboard_navigation(){$(document).unbind();}
function _keyboard_action(objEvent){if(objEvent==null){keycode=event.keyCode;escapeKey=27;}else{keycode=objEvent.keyCode;escapeKey=objEvent.DOM_VK_ESCAPE;}
key=String.fromCharCode(keycode).toLowerCase();if((key==settings.keyToClose)||(key=='x')||(keycode==escapeKey)){_finish();}
if((key==settings.keyToPrev)||(keycode==37)){if(settings.activeImage!=0){settings.activeImage=settings.activeImage-1;_set_image_to_view();_disable_keyboard_navigation();}}
if((key==settings.keyToNext)||(keycode==39)){if(settings.activeImage!=(settings.imageArray.length-1)){settings.activeImage=settings.activeImage+1;_set_image_to_view();_disable_keyboard_navigation();}}}
function _preload_neighbor_images(){if((settings.imageArray.length-1)>settings.activeImage){objNext=new Image();objNext.src=settings.imageArray[settings.activeImage+1][0];}
if(settings.activeImage>0){objPrev=new Image();objPrev.src=settings.imageArray[settings.activeImage-1][0];}}
function _finish(){$('#jquery-lightbox').remove();$('#jquery-overlay').fadeOut(function(){$('#jquery-overlay').remove();});$('embed, object, select').css({'visibility':'visible'});}
function ___getPageSize(){var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=window.innerWidth+window.scrollMaxX;yScroll=window.innerHeight+window.scrollMaxY;}else if(document.body.scrollHeight>document.body.offsetHeight){xScroll=document.body.scrollWidth;yScroll=document.body.scrollHeight;}else{xScroll=document.body.offsetWidth;yScroll=document.body.offsetHeight;}
var windowWidth,windowHeight;if(self.innerHeight){if(document.documentElement.clientWidth){windowWidth=document.documentElement.clientWidth;}else{windowWidth=self.innerWidth;}
windowHeight=self.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){windowWidth=document.documentElement.clientWidth;windowHeight=document.documentElement.clientHeight;}else if(document.body){windowWidth=document.body.clientWidth;windowHeight=document.body.clientHeight;}
if(yScroll<windowHeight){pageHeight=windowHeight;}else{pageHeight=yScroll;}
if(xScroll<windowWidth){pageWidth=xScroll;}else{pageWidth=windowWidth;}
arrayPageSize=new Array(pageWidth,pageHeight,windowWidth,windowHeight);return arrayPageSize;};function ___getPageScroll(){var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}
arrayPageScroll=new Array(xScroll,yScroll);return arrayPageScroll;};function ___pause(ms){var date=new Date();curDate=null;do{var curDate=new Date();}
while(curDate-date<ms);};return this.unbind('click').click(_initialize);};})(jQuery);}
(function(){var $=jQuery;window.XF_LANG=window.XF_LANG||null;function deleteFile(table,field,recordId,callback){if(confirm('Are you sure you want to delete this file?  This cannot be undone.')){var q={'-action':'ajax_upload_delete_temp_file','--field':field,'-table':table,'--recordId':recordId,'--lang':window.XF_LANG};if(!window.XF_LANG){delete q['--lang'];}
$.post(DATAFACE_SITE_HREF,q,function(res){try{if(res.code==200){callback(res);}else{if(res.message)throw res.message;else throw'Failed to delete file.  Unspecified server error.  See server logs for details.';}}catch(e){try{callback(res);}catch(e2){alert(e2);}}});}}
function deleteTempFile(table,field,fileId,callback){var q={'-action':'ajax_upload_delete_temp_file','--field':field,'-table':table,'--fileId':fileId,'--lang':window.XF_LANG};if(!window.XF_LANG){delete q['--lang'];}
$.post(DATAFACE_SITE_HREF,q,function(res){try{if(res.code==200){callback(res);}else{if(res.message)throw res.message;else throw'Failed to delete file.  Unspecified server error.  See server logs for details.';}}catch(e){try{callback(res);}catch(e2){alert(e2);}}});}
registerXatafaceDecorator(function(node){$('input.xf-ajax-upload',node).each(function(){var self=this;if($(self).val()){$(self).attr('data-xf-file-name',$(self).val());}
var fieldName=$(self).attr('data-xf-field');var tableName=$(self).attr('data-xf-table');var thumbnailWidth=$(self).attr('data-xf-thumbnail-width');var thumbnailHeight=$(self).attr('data-xf-thumbnail-height');var uploadInProgress=false;var formGroup=$(self).closest('.xf-form-group');var form=$(self).closest('form');var recordId=formGroup.attr('data-xf-record-id')||'';var recordIdTable=recordId.substr(0,recordId.indexOf('?'));var recordIsRelated=(recordIdTable.indexOf('/')>0);if(recordId=='new'||recordId==undefined||(recordId.indexOf(tableName)!==0&&!recordIsRelated))recordId='';var deleteBtn=$('<button class="xf-ajax-file-upload-delete-button">Delete</button>');var replaceBtn=$('<button class="xf-ajax-file-upload-replace-button">Replace</button>');var cancelUploadBtn=$('<button class="xf-ajax-file-upload-cancel-upload-button">Cancel</button>');var cancelReplaceBtn=$('<button class="xf-ajax-file-upload-cancel-replace-button">Cancel</button>');var jqXHR=null;function fileSizeStr(bytes){bytes=parseFloat(bytes);var units='bytes';if(bytes>1000){bytes=bytes/1000.0;units='kb';}
if(bytes>1000){bytes=bytes/1000.0;units='mb';}
if(bytes>1000){bytes=bytes/1000.0;units='gb';}
return(Math.round(bytes*100)/100)+' '+units;}
function update(){if($(self).val()){var val=$(self).val();var thumbnailUrl=DATAFACE_SITE_HREF+'?-action=ajax_upload_get_thumbnail&--field='+encodeURIComponent(fieldName)+'&-table='+encodeURIComponent(tableName);if(val.indexOf('xftmpimg://')==0){thumbnailUrl+='&--tempfileid='+encodeURIComponent(val.substr(11));}
if(recordId){thumbnailUrl+='&--recordId='+encodeURIComponent(recordId);}
var previewUrl=thumbnailUrl;thumbnailUrl+='&--max_width='+encodeURIComponent(thumbnailWidth);thumbnailUrl+='&--max_height='+encodeURIComponent(thumbnailHeight);if(window.XF_LANG){thumbnailUrl+='&--lang='+encodeURIComponent(window.XF_LANG);}
previewUrl+='&--max_width='+encodeURIComponent(Math.round($(window).width()*0.75));previewUrl+='&--max_height='+encodeURIComponent(Math.round($(window).height()*0.75));if(window.XF_LANG){previewUrl+='&--lang='+encodeURIComponent(window.XF_LANG);}
if(!$(self).attr('data-xf-file-size')||!$(self).attr('data-xf-file-type')||!$(self).attr('data-xf-file-name')||($(self).attr('data-xf-file-name').indexOf('xftmpimg://')==0)){var q={'-table':tableName,'--field':fieldName,'-action':'ajax_upload_get_temp_file_details','--lang':window.XF_LANG};if(!window.XF_LANG){delete q['--lang'];}
if(val.indexOf('xftmpimg://')==0){q['--fileid']=val.substr(11);}else{q['--recordId']=recordId;}
var loadedDetails=false;$(self).attr('data-xf-file-name','Loading details...');$(self).attr('data-xf-file-size',0);$(self).attr('data-xf-file-type','...');previewDiv.hide();uploadDiv.show();setTimeout(function(){if(!loadedDetails){$(self).attr('data-xf-file-name','File not found');$(self).attr('data-xf-file-size',0);$(self).attr('data-xf-file-type','');}},500);$.get(DATAFACE_SITE_HREF,q,function(res){try{$(self).attr('data-xf-file-name',res.name);$(self).attr('data-xf-file-size',res.size);$(self).attr('data-xf-file-type',res.type);if(res.url){$(self).attr('data-xf-preview-url',res.url);}
loadedDetails=true;update();}catch(e){$(self).attr('data-xf-file-name','File not found');$(self).attr('data-xf-file-size',0);$(self).attr('data-xf-file-type','none');$(self).attr('data-xf-preview-url','');update();}});}else{var fileName=$(self).attr('data-xf-file-name');if(!fileName){fileName=val;}
var fileSize=$(self).attr('data-xf-file-size');$('.xf-ajax-upload-filename',previewDiv).text(fileName);if(fileSize){$('.xf-ajax-upload-filesize',previewDiv).show().text(fileSizeStr(fileSize));}else{$('.xf-ajax-upload-filesize',previewDiv).hide();}
previewLink.unbind('click');var fileType=$(self).attr('data-xf-file-type');if(fileType.indexOf('image/')==0){previewLink.lightBox();previewLink.attr('href',previewUrl);}else if($(self).attr('data-xf-preview-url')){previewLink.attr('href',$(self).attr('data-xf-preview-url'));}else{previewLink.click(function(){return false;});}
$('.xf-ajax-upload-thumbnail',previewDiv).attr('src',thumbnailUrl);previewDiv.show();uploadDiv.hide();}}else{previewDiv.hide();uploadDiv.show();}}
$(self).hide();deleteBtn.click(function(){function deleteCallback(res){try{if(res.code==200||res.code==404){$(self).val('');update();}else{if(res.message){throw res.message;}else{throw"Failed to delete file due to server error.  Check server error log for details.";}}}catch(e){alert(e);}}
if($(self).val().indexOf('xftmpimg://')===0){deleteTempFile($(self).attr('data-xf-table'),$(self).attr('data-xf-field'),$(self).val().substr(11),deleteCallback);}else{deleteFile($(self).attr('data-xf-table'),$(self).attr('data-xf-field'),recordId,deleteCallback);}
return false;});replaceBtn.click(function(){uploadDiv.show();cancelReplaceBtn.show();return false;});cancelReplaceBtn.click(function(){uploadDiv.hide();cancelReplaceBtn.hide();return false;});cancelUploadBtn.click(function(){try{jqXHR.abort();}catch(e){}
return false;});$('div.xf-ajax-upload-wrapper',$(self).parent()).remove();var wrapperDiv=$('<div/>').addClass('xf-ajax-upload-wrapper').insertAfter(self);var previewImg=$('<img src="#" class="xf-ajax-upload-thumbnail"/>');var previewLink=$('<a href="#" target="_blank" class="xf-ajax-upload-thumbnail-preview"/>').append(previewImg);var previewDiv=$('<div/>').addClass('xf-ajax-upload-file-preview').append(previewLink).append($('<div class="xf-ajax-upload-filename">Filename</div>')).append($('<div class="xf-ajax-upload-filesize">Filesize</div>')).append($('<div class="xf-ajax-upload-buttons"/>').append(deleteBtn).append(replaceBtn));wrapperDiv.append(previewDiv);var progressBar=$('<div/>').addClass('xf-ajax-upload-progress-bar').progressbar();var progressDiv=$('<div/>').addClass('xf-ajax-upload-progress').append(progressBar).append(cancelUploadBtn).hide();wrapperDiv.append(progressDiv);var uploadDiv=$('<div/>').addClass('xf-ajax-upload-filechooser').append($('<input type="file" class="xf-file-input"/>')).append(cancelReplaceBtn.hide());wrapperDiv.append(uploadDiv);var uploadForm=$("<script>\r\nvar fileUploadErrors = {\r\n    maxFileSize: 'File is too big',\r\n    minFileSize: 'File is too small',\r\n    acceptFileTypes: 'Filetype not allowed',\r\n    maxNumberOfFiles: 'Max number of files exceeded',\r\n    uploadedBytes: 'Uploaded bytes exceed file size',\r\n    emptyResult: 'Empty file upload result'\r\n};\r\n<\/script>\r\n<script id=\"template-upload\" type=\"text\/html\">\r\n{% for (var i=0, files=o.files, l=files.length, file=files[0]; i<l; file=files[++i]) { %}\r\n    <tr class=\"template-upload fade\">\r\n        <td class=\"preview\"><span class=\"fade\"><\/span><\/td>\r\n        <td class=\"name\">{%=file.name%}<\/td>\r\n        <td class=\"size\">{%=o.formatFileSize(file.size)%}<\/td>\r\n        {% if (file.error) { %}\r\n            <td class=\"error\" colspan=\"2\"><span class=\"label important\">Error<\/span> {%=fileUploadErrors[file.error] || file.error%}<\/td>\r\n        {% } else if (o.files.valid && !i) { %}\r\n            <td class=\"progress\"><div class=\"progressbar\"><div style=\"width:0%;\"><\/div><\/div><\/td>\r\n            <td class=\"start\">{% if (!o.options.autoUpload) { %}<button class=\"btn primary\">Start<\/button>{% } %}<\/td>\r\n        {% } else { %}\r\n            <td colspan=\"2\"><\/td>\r\n        {% } %}\r\n        <td class=\"cancel\">{% if (!i) { %}<button class=\"btn info\">Cancel<\/button>{% } %}<\/td>\r\n    <\/tr>\r\n{% } %}\r\n<\/script>\r\n<script id=\"template-download\" type=\"text\/html\">\r\n{% for (var i=0, files=o.files, l=files.length, file=files[0]; i<l; file=files[++i]) { %}\r\n    <tr class=\"template-download fade\">\r\n        {% if (file.error) { %}\r\n            <td><\/td>\r\n            <td class=\"name\">{%=file.name%}<\/td>\r\n            <td class=\"size\">{%=o.formatFileSize(file.size)%}<\/td>\r\n            <td class=\"error\" colspan=\"2\"><span class=\"label important\">Error<\/span> {%=fileUploadErrors[file.error] || file.error%}<\/td>\r\n        {% } else { %}\r\n            <td class=\"preview\">{% if (file.thumbnail_url) { %}\r\n                <a href=\"{%=file.url%}\" title=\"{%=file.name%}\" rel=\"gallery\"><img src=\"{%=file.thumbnail_url%}\"><\/a>\r\n            {% } %}<\/td>\r\n            <td class=\"name\">\r\n                <a href=\"{%=file.url%}\" title=\"{%=file.name%}\" rel=\"{%=file.thumbnail_url&&'gallery'%}\">{%=file.name%}<\/a>\r\n            <\/td>\r\n            <td class=\"size\">{%=o.formatFileSize(file.size)%}<\/td>\r\n            <td colspan=\"2\"><\/td>\r\n        {% } %}\r\n        <td class=\"delete\">\r\n            <button class=\"btn danger\" data-type=\"{%=file.delete_type%}\" data-url=\"{%=file.delete_url%}\">Delete<\/button>\r\n            <input type=\"checkbox\" name=\"delete\" value=\"1\">\r\n        <\/td>\r\n    <\/tr>\r\n{% } %}\r\n<\/script>").insertAfter(uploadDiv);var formData=[{name:'-action',value:'ajax_upload_handleupload'},{name:'--field',value:$(self).attr('data-xf-field')},{name:'-table',value:$(self).attr('data-xf-table')},{name:'--record-id',value:recordId},{name:'--lang',value:window.XF_LANG}];if(!window.XF_LANG){formData.pop();}
var maxFileSize=parseInt($(self).attr('data-xf-max-file-size'));uploadDiv.fileupload({dropZone:wrapperDiv,pasteZone:null,dataType:'json',maxFileSize:maxFileSize,error:function(jqXHR,textStatus,errorThrown){if(errorThrown==='abort'){progressDiv.hide();}else{alert("Upload failed: "+textStatus);}
uploadInProgress=false;uploadDiv.show();},url:DATAFACE_SITE_HREF+'?-action=ajax_upload_handleupload',done:function(e,data){uploadInProgress=false;progressDiv.hide();$.each(data.result,function(index,file){if(typeof(file.error)!='undefined'&&file.error){alert(file.message);}else{$(self).attr('data-xf-file-size',file.size);$(self).attr('data-xf-file-name',file.name);$(self).attr('data-xf-file-type',file.type);$(self).val('xftmpimg://'+file.id);update();$(self).trigger('change');}});},beforeSend:function(event,data){for(var i=0;i<data.files.length;i++){if(data.files[i].fileSize>maxFileSize){alert('This file is too big.  Max allowed size is '+maxFileSize+' bytes but this file is '+data.files[i].fileSize+' bytes.');return false;}
var allowedExtensions=$(self).attr('data-xf-allowed-extensions');if(allowedExtensions){allowedExtensions=allowedExtensions.replace(/ /,'').split(',');var match=false;$.each(allowedExtensions,function(k,val){var regex=new RegExp('\.'+val+'$','i');if(regex.test(data.files[i].name)){match=true;}});if(!match){alert('Upload failed.  Wrong file extension.  Allowed extensions include '+allowedExtensions.join(', ')+' only.');return false;}}
var disallowedExtensions=$(self).attr('data-xf-disallowed-extensions');if(disallowedExtensions){disallowedExtensions=disallowedExtensions.replace(/ /,'').split(',');var match=false;$.each(disallowedExtensions,function(k,val){var regex=new RegExp('\.'+val+'$','i');if(regex.test(data.files[i].name)){match=true;}});if(match){alert('Upload failed.  Disallowed File Extension.');return false;}}}
progressDiv.show();progressBar.progressbar({value:0});jqXHR=event;uploadInProgress=true;uploadDiv.hide();},formData:formData}).bind('fileuploadprogress',function(e,data){progressBar.progressbar({value:(parseInt(data.loaded/data.total*100,10))});});;update();});});})();}
if(typeof(window.__xatajax_included__['xataface/widgets/depends.js'])=='undefined'){window.__xatajax_included__['xataface/widgets/depends.js']=true;if(typeof(window.__xatajax_included__['jsonPath.js'])=='undefined'){window.__xatajax_included__['jsonPath.js']=true;(function(){XataJax.jsonPath=jsonPath;function jsonPath(obj,expr,arg){var P={resultType:arg&&arg.resultType||"VALUE",result:[],normalize:function(expr){var subx=[];return expr.replace(/[\['](\??\(.*?\))[\]']|\['(.*?)'\]/g,function($0,$1,$2){return"[#"+(subx.push($1||$2)-1)+"]";}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function($0,$1){return subx[$1];});},asPath:function(path){var x=path.split(";"),p="$";for(var i=1,n=x.length;i<n;i++)
p+=/^[0-9*]+$/.test(x[i])?("["+x[i]+"]"):("['"+x[i]+"']");return p;},store:function(p,v){if(p)P.result[P.result.length]=P.resultType=="PATH"?P.asPath(p):v;return!!p;},trace:function(expr,val,path){if(expr!==""){var x=expr.split(";"),loc=x.shift();x=x.join(";");if(val&&val.hasOwnProperty(loc))
P.trace(x,val[loc],path+";"+loc);else if(loc==="*")
P.walk(loc,x,val,path,function(m,l,x,v,p){P.trace(m+";"+x,v,p);});else if(loc===".."){P.trace(x,val,path);P.walk(loc,x,val,path,function(m,l,x,v,p){typeof v[m]==="object"&&P.trace("..;"+x,v[m],p+";"+m);});}
else if(/^\(.*?\)$/.test(loc))
P.trace(P.eval(loc,val,path.substr(path.lastIndexOf(";")+1))+";"+x,val,path);else if(/^\?\(.*?\)$/.test(loc))
P.walk(loc,x,val,path,function(m,l,x,v,p){if(P.eval(l.replace(/^\?\((.*?)\)$/,"$1"),v instanceof Array?v[m]:v,m))P.trace(m+";"+x,v,p);});else if(/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(loc))
P.slice(loc,x,val,path);else if(/,/.test(loc)){for(var s=loc.split(/'?,'?/),i=0,n=s.length;i<n;i++)
P.trace(s[i]+";"+x,val,path);}}
else
P.store(path,val);},walk:function(loc,expr,val,path,f){if(val instanceof Array){for(var i=0,n=val.length;i<n;i++)
if(i in val)
f(i,loc,expr,val,path);}
else if(typeof val==="object"){for(var m in val)
if(val.hasOwnProperty(m))
f(m,loc,expr,val,path);}},slice:function(loc,expr,val,path){if(val instanceof Array){var len=val.length,start=0,end=len,step=1;loc.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function($0,$1,$2,$3){start=parseInt($1||start);end=parseInt($2||end);step=parseInt($3||step);});start=(start<0)?Math.max(0,start+len):Math.min(len,start);end=(end<0)?Math.max(0,end+len):Math.min(len,end);for(var i=start;i<end;i+=step)
P.trace(i+";"+expr,val,path);}},eval:function(x,_v,_vname){try{return $&&_v&&eval(x.replace(/(^|[^\\])@/g,"$1_v").replace(/\\@/g,"@"));}
catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/(^|[^\\])@/g,"$1_v").replace(/\\@/g,"@"));}}};var $=obj;if(expr&&obj&&(P.resultType=="VALUE"||P.resultType=="PATH")){P.trace(P.normalize(expr).replace(/^\$;?/,""),obj,"$");return P.result.length?P.result:false;}}})();}
(function(){var $=jQuery;var jsonPath=XataJax.jsonPath;function findField(startNode,fieldName){return XataJax.form.findField(startNode,fieldName);}
function extractVars(str){var out=[];var len=str.length;for(var i=0;i<len;i++){var c=str.charAt(i);if(c==='{'){var varName='';for(var j=i+1;j<len;j++){var d=str.charAt(j);if(d==='}'){break;}
varName+=d;}
i=j;out.push(varName);}}
return out;}
function replaceVars(sourceField,str){var vars=extractVars(str);var len=vars.length;for(var i=0;i<len;i++){var fld=findField(sourceField,vars[i]);str=str.replace('{'+vars[i]+'}',$(fld).val());}
return str;}
function update(field){var urlTemplate=$(field).attr('data-xf-update-url');if(urlTemplate.indexOf('#')<0){return;}
var updateCondition=$(field).attr('data-xf-update-condition');if(updateCondition){if(updateCondition=='empty'&&$(field).val()){return;}}
var query=urlTemplate.substr(urlTemplate.indexOf('#')+1);urlTemplate=urlTemplate.substr(0,urlTemplate.indexOf('#'));if(urlTemplate){var url=replaceVars(field,urlTemplate);$.get(url,function(res){var results=jsonPath(res,query);if(results&&results.length>0){var oldVal=$(field).val();if(oldVal!=results[0]){$(field).val(results[0]);$(field).trigger('change');}}});}else{var newVal=replaceVars(field,query);var oldVal=$(field).val();if(oldVal!=newVal){$(field).val(newVal);$(field).trigger('change');}}}
registerXatafaceDecorator(function(node){$('[data-xf-update-url]').each(function(){var depField=this;var varNames=extractVars($(depField).attr('data-xf-update-url'));var len=varNames.length;for(var i=0;i<len;i++){var varName=varNames[i];var fld=findField(this,varName);if(fld){$(fld).change(function(){update(depField);});}}});});})();}
if(typeof(XataJax)!="undefined")XataJax.ready();